<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>虚拟博物馆</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css"/>
    <style>
        html, body { margin: 0; height: 100%; }
        #panorama { width: 100%; height: 100%; }
        
        /* 龙文物展示模态框样式 */
        .dragon-modal {
            display: none;
            position: fixed;
            z-index: 99999 !important;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        /* 解码馆图片展示样式 */
        .hall-image-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 99999;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }
        
        .hall-image {
            max-width: 80vw;
            max-height: 70vh;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .hall-image-nav {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .hall-nav-btn {
            background: #8B4513;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .hall-nav-btn:hover {
            background: #A0522D;
        }
        
        .hall-nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .hall-image-counter {
            margin-top: 10px;
            font-size: 16px;
            color: #8B4513;
            font-weight: bold;
        }
        
        .dragon-modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 99999 !important;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        .dragon-images {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .dragon-image {
            max-width: 45%;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .dragon-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        
        .dragon-description {
            text-align: center;
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }
        
        /* 确保在全屏模式下模态框也能显示 */
        .pannellum-container:fullscreen .dragon-modal,
        .pannellum-container:-webkit-full-screen .dragon-modal,
        .pannellum-container:-moz-full-screen .dragon-modal {
            z-index: 99999 !important;
        }
        
        /* 强制模态框显示在所有元素之上 */
        .dragon-modal {
            pointer-events: auto !important;
        }
        

        

    </style>
</head>
<body>
<div id="panorama"></div>

<!-- 龙文物展示模态框 -->
<div id="dragonModal" class="dragon-modal">
    <div class="dragon-modal-content">
        <span class="close">&times;</span>
        <div id="dragonTitle" class="dragon-title"></div>
        <div id="dragonDescription" class="dragon-description"></div>
        <div id="dragonImages" class="dragon-images"></div>
    </div>
</div>

<!-- 解码馆图片展示 -->
<div id="hallImageDisplay" class="hall-image-display" style="display: none;">
    <img id="hallCurrentImage" class="hall-image" src="" alt="解码馆图片">
    
    <!-- 龙身体部位热点 -->
    <div class="dragon-hotspots">
        <!-- 角 - 鹿 -->
        <div class="dragon-hotspot" data-part="horn" style="position: absolute; top: 1%; left: 8%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 前额 - 骆驼 -->
        <div class="dragon-hotspot" data-part="forehead" style="position: absolute; top: 1%; left: 38%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 眼 - 老虎 -->
        <div class="dragon-hotspot" data-part="eye" style="position: absolute; top: 3%; left: 87%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 尾 - 泥鳅 -->
        <div class="dragon-hotspot" data-part="tail" style="position: absolute; top: 40%; left: 88%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 爪 - 鹰 -->
        <div class="dragon-hotspot" data-part="claw" style="position: absolute; top: 68%; left: 88%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 鳞 - 金鱼 -->
        <div class="dragon-hotspot" data-part="scale" style="position: absolute; top: 65%; left: 7%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 身 - 蛇 -->
        <div class="dragon-hotspot" data-part="body" style="position: absolute; top: 43%; left: 7%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
    </div>
    
    <div class="hall-image-nav">
        <button id="closeHallBtn" class="hall-nav-btn">关闭</button>
    </div>
</div>

<!-- 动物信息展示模态框 -->
<div id="animalModal" class="dragon-modal" style="display: none;">
    <div class="dragon-modal-content" style="max-width: 600px;">
        <span class="close" onclick="closeAnimalModal()">&times;</span>
        <div id="animalTitle" class="dragon-title"></div>
        <div id="animalDescription" class="dragon-description"></div>
        <div id="animalImage" style="text-align: center; margin: 20px 0;">
            <img id="animalImg" src="" alt="动物图片" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
<script>
    // 龙文物数据
    const dragonArtifacts = {
        "yuzhulong": {
            title: "玉猪龙",
            description: "新石器时代红山文化玉器，是中国最早的龙形玉器之一",
            images: [
                "images/2.museum/dragons/玉猪龙1.jpg",
                "images/2.museum/dragons/玉猪龙2.jpg"
            ]
        },
        "handai": {
            title: "汉代瓦当",
            description: "汉代建筑构件，龙纹瓦当展现了汉代龙文化的特点",
            images: [
                "images/2.museum/dragons/瓦当汉代1.jpg",
                "images/2.museum/dragons/瓦当汉代2.jpg"
            ]
        },
        "suidai": {
            title: "隋代赵州桥石栏板",
            description: "隋代建筑艺术，石栏板上的龙纹雕刻精美绝伦",
            images: [
                "images/2.museum/dragons/隋代赵州桥石栏板1.jpg",
                "images/2.museum/dragons/隋代赵州桥石栏板2.jpg"
            ]
        },
        "tangdai": {
            title: "云龙纹葵花镜",
            description: "唐代铜镜，云龙纹饰体现了唐代龙文化的繁荣",
            images: [
                "images/2.museum/dragons/云龙纹葵花镜1.jpg",
                "images/2.museum/dragons/云龙纹葵花镜2.jpg"
            ]
        },
        "yuandai": {
            title: "元代龙纹高足杯",
            description: "元代瓷器，龙纹装饰展现了元代龙文化的特色",
            images: [
                "images/2.museum/dragons/元代龙纹高足杯1.jpg",
                "images/2.museum/dragons/元代龙纹高足杯2.jpg"
            ]
        },
        "mingqing": {
            title: "明清时代的龙",
            description: "明清时期龙文化达到顶峰，龙纹装饰更加精细华丽",
            images: [
                "images/2.museum/dragons/明清时代的龙1.jpg",
                "images/2.museum/dragons/明清时代的龙2.jpg"
            ]
        }
    };

    // 定义所有场景
    const scenes = {
        "entrance": {
            "title": "龙国",
            "panorama": "images/1.country/DragonCountry.png",
            "hotSpots": [
                {
                    "pitch": -25,      // 垂直角度
                    "yaw": 20,       // 水平角度
                    "type": "scene", // 点击切换场景
                    "text": "进入龙国博物馆",
                    "sceneId": "museum"
                }
            ]
        },
        "museum": {
            "title": "龙博物馆",
            "panorama": "images/2.museum/场景背景参考1.png",
            "initialViewParameters": {
                "pitch": -25,
                "yaw": 0,
                "fov": 140
            },
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": 180,
                    "type": "scene",
                    "text": "返回龙国",
                    "sceneId": "entrance"
                },
                {
                    "pitch": -10,
                    "yaw": 0,
                    "type": "scene",
                    "text": "进入龙解码馆",
                    "sceneId": "hall"
                },
                // 玉猪龙标签
                {
                    "pitch": -15,
                    "yaw": 45,
                    "type": "info",
                    "text": "玉猪龙",
                    "clickHandlerFunc": function() { showDragonArtifact('yuzhulong'); }
                },
                // 汉代瓦当标签
                {
                    "pitch": -10,
                    "yaw": 90,
                    "type": "info",
                    "text": "汉代瓦当",
                    "clickHandlerFunc": function() { showDragonArtifact('handai'); }
                },
                // 隋代赵州桥石栏板标签
                {
                    "pitch": -5,
                    "yaw": 135,
                    "type": "info",
                    "text": "隋代赵州桥石栏板",
                    "clickHandlerFunc": function() { showDragonArtifact('suidai'); }
                },
                // 云龙纹葵花镜标签
                {
                    "pitch": -12,
                    "yaw": -45,
                    "type": "info",
                    "text": "云龙纹葵花镜",
                    "clickHandlerFunc": function() { showDragonArtifact('tangdai'); }
                },
                // 元代龙纹高足杯标签
                {
                    "pitch": -8,
                    "yaw": -90,
                    "type": "info",
                    "text": "元代龙纹高足杯",
                    "clickHandlerFunc": function() { showDragonArtifact('yuandai'); }
                },
                // 明清时代的龙标签
                {
                    "pitch": -18,
                    "yaw": -135,
                    "type": "info",
                    "text": "明清时代的龙",
                    "clickHandlerFunc": function() { showDragonArtifact('mingqing'); }
                }

            ]
        },
        "hall": {
            "title": "龙解码馆",
            "panorama": "images/3.Hall/场景背景参考1.jpg",
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": 150,
                    "type": "scene",
                    "text": "返回龙博物馆",
                    "sceneId": "museum"
                }
            ]
        }
    };

    // 显示龙文物信息的函数
    function showDragonArtifact(artifactKey) {
        const artifact = dragonArtifacts[artifactKey];
        if (!artifact) return;
        
        // 更新模态框内容
        document.getElementById('dragonTitle').textContent = artifact.title;
        document.getElementById('dragonDescription').textContent = artifact.description;
        
        // 清空并添加图片
        const imagesContainer = document.getElementById('dragonImages');
        imagesContainer.innerHTML = '';
        
        artifact.images.forEach(imagePath => {
            const img = document.createElement('img');
            img.src = imagePath;
            img.alt = artifact.title;
            img.className = 'dragon-image';
            imagesContainer.appendChild(img);
        });
        
        // 强制显示模态框
        const modal = document.getElementById('dragonModal');
        
        // 多重方法确保显示
        modal.style.display = 'block';
        modal.style.zIndex = '99999';
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.width = '100%';
        modal.style.height = '100%';
        
        // 确保模态框在最顶层
        setTimeout(() => {
            modal.style.display = 'none';
            modal.offsetHeight; // 触发重排
            modal.style.display = 'block';
            
            // 再次强制设置z-index
            modal.style.zIndex = '99999';
            
            // 检查是否在全屏模式
            if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement) {
                modal.style.zIndex = '999999';
            }
        }, 10);
    }

    // 关闭模态框
    document.querySelector('.close').onclick = function() {
        document.getElementById('dragonModal').style.display = 'none';
    }

    // 点击模态框外部关闭
    window.onclick = function(event) {
        const dragonModal = document.getElementById('dragonModal');
        const animalModal = document.getElementById('animalModal');
        
        if (event.target == dragonModal) {
            dragonModal.style.display = 'none';
        }
        
        if (event.target == animalModal) {
            closeAnimalModal();
        }
    }

    // 解码馆图片数据
    const hallImages = [
        "images/3.Hall/龙.png"
    ];
    
    // 龙身体部位对应的动物数据
    const dragonParts = {
        "horn": {
            name: "角",
            animal: "鹿",
            image: "images/3.Hall/鹿.png",
            description: "龙的角来源于鹿的鹿角"
        },
        "forehead": {
            name: "前额",
            animal: "骆驼",
            image: "images/3.Hall/骆驼.png",
            description: "龙的前额来源于骆驼的额头"
        },
        "eye": {
            name: "眼",
            animal: "老虎",
            image: "images/3.Hall/老虎.png",
            description: "龙的眼睛来源于老虎的眼睛"
        },
        "tail": {
            name: "尾",
            animal: "泥鳅",
            image: "images/3.Hall/泥鳅.png",
            description: "龙的尾巴来源于泥鳅的尾巴"
        },
        "claw": {
            name: "爪",
            animal: "鹰",
            image: "images/3.Hall/鹰.png",
            description: "龙的爪子来源于鹰的爪子"
        },
        "scale": {
            name: "鳞",
            animal: "金鱼",
            image: "images/3.Hall/金鱼.png",
            description: "龙的鳞片来源于金鱼的鳞片"
        },
        "body": {
            name: "身",
            animal: "蛇",
            image: "images/3.Hall/蛇.png",
            description: "龙的身体来源于蛇的身体"
        }
    };
    
    let currentHallImageIndex = 0;
    
    // 初始化 Pannellum Viewer
    const viewer = pannellum.viewer('panorama', {
        "default": {
            "firstScene": "entrance", // 初始场景
            "author": "你的名字",
            "sceneFadeDuration": 1000
        },
        "scenes": scenes
    });
    
    // 监听场景切换事件，为博物馆场景添加进入动画
    viewer.on('scenechange', function(sceneId) {
        if (sceneId === 'museum') {
            // 延迟执行进入动画，确保场景加载完成
            setTimeout(function() {
                // 从远到近的进入效果：设置较远的起始视角
                viewer.setPitch(-25);
                viewer.setYaw(0);
                viewer.setHfov(140);
                
                // 第一阶段：缓慢推进
                setTimeout(function() {
                    viewer.animate({
                        pitch: -20,
                        yaw: 0,
                        hfov: 120,
                        speed: '0.3rpm'
                    });
                }, 800);
                
                // 第二阶段：继续推进
                setTimeout(function() {
                    viewer.animate({
                        pitch: -15,
                        yaw: 0,
                        hfov: 100,
                        speed: '0.4rpm'
                    });
                }, 3000);
                
                // 第三阶段：最终到达目标位置
                setTimeout(function() {
                    viewer.animate({
                        pitch: -5,
                        yaw: 0,
                        hfov: 90,
                        speed: '0.2rpm'
                    });
                }, 6000);
            }, 500);
        } else if (sceneId === 'hall') {
            // 进入解码馆时自动显示图片1
            setTimeout(function() {
                showHallImage(0);
            }, 1000);
        }
    });
    
    // 显示解码馆图片
    function showHallImage(index) {
        if (index >= 0 && index < hallImages.length) {
            currentHallImageIndex = index;
            const imageDisplay = document.getElementById('hallImageDisplay');
            const currentImage = document.getElementById('hallCurrentImage');
            
            currentImage.src = hallImages[index];
            imageDisplay.style.display = 'block';
            
            // 绑定龙身体部位热点事件
            bindDragonHotspots();
        }
    }
    
    // 绑定龙身体部位热点事件
    function bindDragonHotspots() {
        const hotspots = document.querySelectorAll('.dragon-hotspot');
        hotspots.forEach(hotspot => {
            // 重置热点为初始状态（隐藏状态）
            const partKey = hotspot.getAttribute('data-part');
            const part = dragonParts[partKey];
            if (part) {
                hotspot.innerHTML = '';
                hotspot.style.background = 'transparent';
                hotspot.style.border = 'none';
                hotspot.style.display = 'flex';
                hotspot.style.alignItems = 'center';
                hotspot.style.justifyContent = 'center';
                hotspot.style.width = '100px';
                hotspot.style.height = '100px';
            }
            
            hotspot.onclick = function() {
                const part = this.getAttribute('data-part');
                showAnimalInfo(part);
            };
        });
    }
    
    // 显示动物信息
    function showAnimalInfo(partKey) {
        const part = dragonParts[partKey];
        if (!part) return;
        
        const modal = document.getElementById('animalModal');
        const title = document.getElementById('animalTitle');
        const description = document.getElementById('animalDescription');
        const animalImg = document.getElementById('animalImg');
        
        title.textContent = `${part.name} (${part.animal})`;
        description.textContent = part.description;
        animalImg.src = part.image;
        animalImg.alt = part.animal;
        
        // 存储当前显示的部位信息
        modal.dataset.currentPart = partKey;
        
        modal.style.display = 'block';
    }
    
    // 关闭动物信息模态框并显示小图片
    function closeAnimalModal() {
        const modal = document.getElementById('animalModal');
        const partKey = modal.dataset.currentPart;
        const part = dragonParts[partKey];
        
        if (part) {
            // 找到对应的热点元素
            const hotspot = document.querySelector(`[data-part="${partKey}"]`);
            if (hotspot) {
                // 清空热点内容并添加小图片
                hotspot.innerHTML = '';
                hotspot.style.background = 'rgba(255, 255, 255, 0.9)';
                hotspot.style.border = '2px solid #8B4513';
                hotspot.style.borderRadius = '50%';
                hotspot.style.display = 'flex';
                hotspot.style.alignItems = 'center';
                hotspot.style.justifyContent = 'center';
                hotspot.style.overflow = 'hidden';
                hotspot.style.width = '100px';
                hotspot.style.height = '100px';
                
                // 创建小图片
                const smallImg = document.createElement('img');
                smallImg.src = part.image;
                smallImg.alt = part.animal;
                smallImg.style.width = '100px';
                smallImg.style.height = '100px';
                smallImg.style.objectFit = 'cover';
                smallImg.style.borderRadius = '50%';
                
                hotspot.appendChild(smallImg);
                
                // 更新点击事件，点击小图片可以重新打开模态框
                hotspot.onclick = function() {
                    showAnimalInfo(partKey);
                };
            }
        }
        
        modal.style.display = 'none';
    }
    
    // 关闭解码馆图片显示
    function closeHallImage() {
        document.getElementById('hallImageDisplay').style.display = 'none';
    }
    
    // 绑定按钮事件
    document.getElementById('closeHallBtn').onclick = closeHallImage;
</script>
</body>
</html>
