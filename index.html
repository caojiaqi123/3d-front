<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>虚拟博物馆</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.css"/>
    <style>
        html, body { margin: 0; height: 100%; }
        #panorama { width: 100%; height: 100%; }
        
        /* 龙文物展示模态框样式 */
        .dragon-modal {
            display: none;
            position: fixed;
            z-index: 2147483647 !important;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        
        /* 全屏模式下的模态框样式 */
        :fullscreen .dragon-modal,
        :-webkit-full-screen .dragon-modal,
        :-moz-full-screen .dragon-modal {
            z-index: 2147483647 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
        }
        
        /* 全屏模式下的解码馆图片展示样式 */
        :fullscreen .hall-image-display,
        :-webkit-full-screen .hall-image-display,
        :-moz-full-screen .hall-image-display {
            z-index: 2147483647 !important;
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
        }
        
        /* 全屏模式下的缩略图显示样式 */
        :fullscreen .thumbnail-display,
        :-webkit-full-screen .thumbnail-display,
        :-moz-full-screen .thumbnail-display {
            z-index: 2147483647 !important;
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
        }
        
        /* 解码馆图片展示样式 */
        .hall-image-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2147483647 !important;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
        }
        
        .hall-image {
            max-width: 80vw;
            max-height: 70vh;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .hall-image-nav {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .hall-nav-btn {
            background: #8B4513;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .hall-nav-btn:hover {
            background: #A0522D;
        }
        
        .hall-nav-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .hall-image-counter {
            margin-top: 10px;
            font-size: 16px;
            color: #8B4513;
            font-weight: bold;
        }
        
        .dragon-modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 800px;
            border-radius: 10px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 2147483647 !important;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        .dragon-images {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .dragon-image {
            max-width: 45%;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .dragon-title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }
        
        .dragon-description {
            text-align: center;
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }
        
        /* 确保在全屏模式下模态框也能显示 */
        .pannellum-container:fullscreen .dragon-modal,
        .pannellum-container:-webkit-full-screen .dragon-modal,
        .pannellum-container:-moz-full-screen .dragon-modal {
            z-index: 99999 !important;
        }
        
        /* 强制模态框显示在所有元素之上 */
        .dragon-modal {
            pointer-events: auto !important;
        }
        
        /* 缩略图显示样式 */
        .thumbnail-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2147483647 !important;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 90vw;
            max-height: 80vh;
            animation: thumbnailFadeIn 0.3s ease-out;
        }
        
        .thumbnail-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            margin-bottom: 15px;
        }
        
        .thumbnail-title {
            font-size: 20px;
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 10px;
        }
        
        .thumbnail-description {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
            margin-bottom: 15px;
        }
        
        .thumbnail-close {
            background: #8B4513;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .thumbnail-close:hover {
            background: #A0522D;
        }
        
        @keyframes thumbnailFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        /* 玉猪龙图片展示样式 */
        .yuzhulong-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2147483647 !important;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 90vw;
            max-height: 80vh;
            animation: yuzhulongFadeIn 0.5s ease-out;
        }
        
        .yuzhulong-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            margin-bottom: 20px;
        }
        
        .yuzhulong-title {
            font-size: 24px;
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 15px;
        }
        
        .yuzhulong-description {
            font-size: 16px;
            color: #666;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .yuzhulong-close {
            background: #8B4513;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        
        .yuzhulong-close:hover {
            background: #A0522D;
        }
        
        @keyframes yuzhulongFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.7) rotate(-2deg);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1) rotate(0deg);
            }
        }
        
        /* 博物馆场景中嵌入的玉猪龙图片样式 */
        .museum-yuzhulong {
            position: absolute;
            top: 20%;
            right: 10%;
            width: 200px;
            height: 250px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border: 3px solid #8B4513;
            animation: museumYuzhulongFloat 3s ease-in-out infinite;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .museum-yuzhulong:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
        }
        
        .museum-yuzhulong img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 10px;
        }
        
        .museum-yuzhulong-title {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(139, 69, 19, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        @keyframes museumYuzhulongFloat {
            0%, 100% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .museum-yuzhulong {
                width: 150px;
                height: 180px;
                top: 15%;
                right: 5%;
            }
            
            .museum-yuzhulong-title {
                font-size: 12px;
                padding: 6px 12px;
            }
        }
        

        

        

        

    </style>
</head>
<body>
<div id="panorama"></div>

<!-- 博物馆场景中嵌入的玉猪龙 -->
<div id="museumYuzhulong" class="museum-yuzhulong" style="display: none;" onclick="showDragonArtifact('yuzhulong')">
    <img src="images/2.museum/玉猪龙.png" alt="玉猪龙">
    <div class="museum-yuzhulong-title">玉猪龙</div>
</div>

<!-- 龙文物展示模态框 -->
<div id="dragonModal" class="dragon-modal">
    <div class="dragon-modal-content">
        <span class="close">&times;</span>
        <div id="dragonTitle" class="dragon-title"></div>
        <div id="dragonDescription" class="dragon-description"></div>
        <div id="dragonImages" class="dragon-images"></div>
    </div>
</div>

<!-- 解码馆图片展示 -->
<div id="hallImageDisplay" class="hall-image-display" style="display: none;">
    <img id="hallCurrentImage" class="hall-image" src="" alt="解码馆图片">
    
    <!-- 龙身体部位热点 -->
    <div class="dragon-hotspots">
        <!-- 角 - 鹿 -->
        <div class="dragon-hotspot" data-part="horn" style="position: absolute; top: 1%; left: 8%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 前额 - 骆驼 -->
        <div class="dragon-hotspot" data-part="forehead" style="position: absolute; top: 1%; left: 38%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 眼 - 老虎 -->
        <div class="dragon-hotspot" data-part="eye" style="position: absolute; top: 3%; left: 87%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 尾 - 泥鳅 -->
        <div class="dragon-hotspot" data-part="tail" style="position: absolute; top: 40%; left: 88%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 爪 - 鹰 -->
        <div class="dragon-hotspot" data-part="claw" style="position: absolute; top: 68%; left: 88%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 鳞 - 金鱼 -->
        <div class="dragon-hotspot" data-part="scale" style="position: absolute; top: 65%; left: 7%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
        
        <!-- 身 - 蛇 -->
        <div class="dragon-hotspot" data-part="body" style="position: absolute; top: 43%; left: 7%; width: 100px; height: 100px; cursor: pointer; background: transparent; border: none; display: flex; align-items: center; justify-content: center;"></div>
    </div>
    

    
    <div class="hall-image-nav">
        <button id="closeHallBtn" class="hall-nav-btn">关闭</button>
        <button id="resetBtn" class="hall-nav-btn" style="background: #D2691E;">重置</button>
    </div>
</div>

<!-- 动物信息展示模态框 -->
<div id="animalModal" class="dragon-modal" style="display: none;">
    <div class="dragon-modal-content" style="max-width: 600px;">
        <span class="close" onclick="closeAnimalModal()">&times;</span>
        <div id="animalTitle" class="dragon-title"></div>
        <div id="animalDescription" class="dragon-description"></div>
        <div id="animalImage" style="text-align: center; margin: 20px 0;">
            <img id="animalImg" src="" alt="动物图片" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        </div>
    </div>
</div>

<!-- 集合文字展示模态框 -->
<div id="collectionModal" class="dragon-modal" style="display: none;">
    <div class="dragon-modal-content" style="max-width: 800px;">
        <span class="close" onclick="closeCollectionModal()">&times;</span>
        <div class="dragon-title" style="color: #8B4513; font-size: 28px; margin-bottom: 20px;">龙，乃万兽之首</div>
        <div class="dragon-description" style="font-size: 18px; line-height: 1.6; text-align: justify; color: #333;">
            人们为龙选用的不同动物的部位，是摄取了最精华、最完美的部位，集如此多优势于一身的造型自然是万物之灵，同时也寄托了人们美好的愿望。
        </div>
        <div id="collectionImages" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 30px;">
            <!-- 集合的动物图片将在这里显示 -->
        </div>
    </div>
</div>

<!-- 缩略图显示 -->
<div id="thumbnailDisplay" class="thumbnail-display" style="display: none;">
    <img id="thumbnailImage" class="thumbnail-image" src="" alt="文物缩略图">
    <div id="thumbnailTitle" class="thumbnail-title"></div>
    <div id="thumbnailDescription" class="thumbnail-description"></div>
    <button id="closeThumbnailBtn" class="thumbnail-close">关闭</button>
</div>

<!-- 玉猪龙图片显示 -->
<div id="yuzhulongDisplay" class="yuzhulong-display" style="display: none;">
    <img id="yuzhulongImage" class="yuzhulong-image" src="images/2.museum/玉猪龙.png" alt="玉猪龙">
    <div class="yuzhulong-title">玉猪龙</div>
    <div class="yuzhulong-description">新石器时代红山文化玉器，是中国最早的龙形玉器之一，具有重要的历史和文化价值。</div>
    <button id="closeYuzhulongBtn" class="yuzhulong-close">关闭</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/pannellum/build/pannellum.js"></script>
<script>
    // 龙文物数据
    const dragonArtifacts = {
        "yuzhulong": {
            title: "玉猪龙",
            description: "新石器时代红山文化玉器，是中国最早的龙形玉器之一",
            images: [
                "images/2.museum/dragons/玉猪龙1.jpg",
                "images/2.museum/dragons/玉猪龙2.jpg"
            ]
        },
        "handai": {
            title: "汉代瓦当",
            description: "汉代建筑构件，龙纹瓦当展现了汉代龙文化的特点",
            images: [
                "images/2.museum/dragons/瓦当汉代1.jpg",
                "images/2.museum/dragons/瓦当汉代2.jpg"
            ]
        },
        "suidai": {
            title: "隋代赵州桥石栏板",
            description: "隋代建筑艺术，石栏板上的龙纹雕刻精美绝伦",
            images: [
                "images/2.museum/dragons/隋代赵州桥石栏板1.jpg",
                "images/2.museum/dragons/隋代赵州桥石栏板2.jpg"
            ]
        },
        "tangdai": {
            title: "云龙纹葵花镜",
            description: "唐代铜镜，云龙纹饰体现了唐代龙文化的繁荣",
            images: [
                "images/2.museum/dragons/云龙纹葵花镜1.jpg",
                "images/2.museum/dragons/云龙纹葵花镜2.jpg"
            ]
        },
        "yuandai": {
            title: "元代龙纹高足杯",
            description: "元代瓷器，龙纹装饰展现了元代龙文化的特色",
            images: [
                "images/2.museum/dragons/元代龙纹高足杯1.jpg",
                "images/2.museum/dragons/元代龙纹高足杯2.jpg"
            ]
        },
        "mingqing": {
            title: "明清时代的龙",
            description: "明清时期龙文化达到顶峰，龙纹装饰更加精细华丽",
            images: [
                "images/2.museum/dragons/明清时代的龙1.jpg",
                "images/2.museum/dragons/明清时代的龙2.jpg"
            ]
        }
    };

    // 定义所有场景
    const scenes = {
        "entrance": {
            "title": "龙国",
            "panorama": "images/1.country/DragonCountry.png",
            "initialViewParameters": {
                "pitch": -45,  // 俯视角度
                "yaw": 0,      // 水平角度
                "fov": 360     // 直接设置为拉远状态
            },
            "hotSpots": [
                {
                    "pitch": -25,      // 垂直角度
                    "yaw": 20,       // 水平角度
                    "type": "scene", // 点击切换场景
                    "text": "进入龙国博物馆",
                    "sceneId": "museum"
                }
            ]
        },
        "museum": {
            "title": "龙博物馆",
            "panorama": "images/2.museum/场景背景参考1.png",
            "initialViewParameters": {
                "pitch": -25,
                "yaw": 0,
                "fov": 140
            },
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": 180,
                    "type": "scene",
                    "text": "返回龙国",
                    "sceneId": "entrance"
                },
                {
                    "pitch": -10,
                    "yaw": 0,
                    "type": "scene",
                    "text": "进入龙解码馆",
                    "sceneId": "hall"
                },
                // 玉猪龙标签
                {
                    "pitch": -15,
                    "yaw": 45,
                    "type": "info",
                    "text": "玉猪龙",
                    "clickHandlerFunc": function() { showDragonArtifact('yuzhulong'); },
                    "dblClickHandlerFunc": function() { showThumbnail('yuzhulong'); }
                },
                // 汉代瓦当标签
                {
                    "pitch": -10,
                    "yaw": 90,
                    "type": "info",
                    "text": "汉代瓦当",
                    "clickHandlerFunc": function() { showDragonArtifact('handai'); },
                    "dblClickHandlerFunc": function() { showThumbnail('handai'); }
                },
                // 隋代赵州桥石栏板标签
                {
                    "pitch": -5,
                    "yaw": 135,
                    "type": "info",
                    "text": "隋代赵州桥石栏板",
                    "clickHandlerFunc": function() { showDragonArtifact('suidai'); },
                    "dblClickHandlerFunc": function() { showThumbnail('suidai'); }
                },
                // 云龙纹葵花镜标签
                {
                    "pitch": -18,
                    "yaw": -135,
                   
                    "type": "info",
                    "text": "云龙纹葵花镜",
                    "clickHandlerFunc": function() { showDragonArtifact('tangdai'); },
                    "dblClickHandlerFunc": function() { showThumbnail('tangdai'); }
                },
                // 元代龙纹高足杯标签
                {
              
                    "pitch": -8,
                    "yaw": -90,
                    "type": "info",
                    "text": "元代龙纹高足杯",
                    "clickHandlerFunc": function() { showDragonArtifact('yuandai'); },
                    "dblClickHandlerFunc": function() { showThumbnail('yuandai'); }
                },
                // 明清时代的龙标签
                {
                    "pitch": -12,
                    "yaw": -45,
                    "type": "info",
                    "text": "明清时代的龙",
                    "clickHandlerFunc": function() { showDragonArtifact('mingqing'); },
                    "dblClickHandlerFunc": function() { showThumbnail('mingqing'); }
                }

            ]
        },
        "hall": {
            "title": "龙解码馆",
            "panorama": "images/3.Hall/场景背景参考1.jpg",
            "hotSpots": [
                {
                    "pitch": 0,
                    "yaw": 0,
                    "type": "scene",
                    "text": "返回龙博物馆",
                    "sceneId": "museum"
                }
            ]
        }
    };

    // 显示龙文物信息的函数
    function showDragonArtifact(artifactKey) {
        const artifact = dragonArtifacts[artifactKey];
        if (!artifact) return;
        
        // 更新模态框内容
        document.getElementById('dragonTitle').textContent = artifact.title;
        document.getElementById('dragonDescription').textContent = artifact.description;
        
        // 清空并添加图片
        const imagesContainer = document.getElementById('dragonImages');
        imagesContainer.innerHTML = '';
        
        artifact.images.forEach(imagePath => {
            const img = document.createElement('img');
            img.src = imagePath;
            img.alt = artifact.title;
            img.className = 'dragon-image';
            imagesContainer.appendChild(img);
        });
        
        // 强制显示模态框
        const modal = document.getElementById('dragonModal');
        
        // 确保模态框在body的最顶层
        if (modal.parentNode !== document.body) {
            document.body.appendChild(modal);
        }
        
        // 多重方法确保显示
        modal.style.display = 'block';
        modal.style.zIndex = '2147483647';
        modal.style.position = 'fixed';
        modal.style.top = '0';
        modal.style.left = '0';
        modal.style.width = '100%';
        modal.style.height = '100%';
        
        // 确保模态框在最顶层
        setTimeout(() => {
            modal.style.display = 'none';
            modal.offsetHeight; // 触发重排
            modal.style.display = 'block';
            
            // 再次强制设置z-index
            modal.style.zIndex = '2147483647';
            
            // 检查是否在全屏模式
            if (document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement) {
                modal.style.zIndex = '2147483647';
            }
        }, 10);
        
        // 添加调试信息
        console.log('显示文物:', artifactKey);
        console.log('模态框z-index:', modal.style.zIndex);
        console.log('全屏模式:', document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement);
        
        // 强制刷新模态框显示
        setTimeout(() => {
            modal.style.display = 'none';
            modal.offsetHeight; // 触发重排
            modal.style.display = 'block';
            modal.style.zIndex = '2147483647';
            console.log('强制刷新后z-index:', modal.style.zIndex);
        }, 50);
    }
    
    // 显示玉猪龙图片函数
    function showYuzhulongImage() {
        const yuzhulongDisplay = document.getElementById('yuzhulongDisplay');
        
        // 确保玉猪龙显示在body的最顶层
        if (yuzhulongDisplay.parentNode !== document.body) {
            document.body.appendChild(yuzhulongDisplay);
        }
        
        yuzhulongDisplay.style.display = 'block';
        yuzhulongDisplay.style.zIndex = '2147483647';
        
        // 检查是否在全屏模式
        const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
        if (isFullscreen) {
            yuzhulongDisplay.style.zIndex = '2147483647';
        }
        
        // 强制刷新显示
        setTimeout(() => {
            yuzhulongDisplay.style.display = 'none';
            yuzhulongDisplay.offsetHeight; // 触发重排
            yuzhulongDisplay.style.display = 'block';
            yuzhulongDisplay.style.zIndex = '2147483647';
            console.log('玉猪龙显示，z-index:', yuzhulongDisplay.style.zIndex, '全屏模式:', isFullscreen);
        }, 10);
    }
    
    // 关闭玉猪龙图片显示
    function closeYuzhulongImage() {
        document.getElementById('yuzhulongDisplay').style.display = 'none';
    }
    
    // 显示缩略图函数
    function showThumbnail(artifactKey) {
        const artifact = dragonArtifacts[artifactKey];
        if (!artifact) return;
        
        // 更新缩略图内容
        document.getElementById('thumbnailImage').src = artifact.images[0]; // 显示第一张图片作为缩略图
        document.getElementById('thumbnailImage').alt = artifact.title;
        document.getElementById('thumbnailTitle').textContent = artifact.title;
        document.getElementById('thumbnailDescription').textContent = artifact.description;
        
        // 显示缩略图
        const thumbnailDisplay = document.getElementById('thumbnailDisplay');
        
        // 确保缩略图在body的最顶层
        if (thumbnailDisplay.parentNode !== document.body) {
            document.body.appendChild(thumbnailDisplay);
        }
        
        thumbnailDisplay.style.display = 'block';
        thumbnailDisplay.style.zIndex = '2147483647';
        
        // 检查是否在全屏模式
        const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
        if (isFullscreen) {
            thumbnailDisplay.style.zIndex = '2147483647';
        }
        
        // 强制刷新显示
        setTimeout(() => {
            thumbnailDisplay.style.display = 'none';
            thumbnailDisplay.offsetHeight; // 触发重排
            thumbnailDisplay.style.display = 'block';
            thumbnailDisplay.style.zIndex = '2147483647';
            console.log('缩略图显示，z-index:', thumbnailDisplay.style.zIndex, '全屏模式:', isFullscreen);
        }, 10);
        
        // 3秒后自动关闭
        setTimeout(() => {
            closeThumbnail();
        }, 3000);
    }
    
    // 关闭缩略图函数
    function closeThumbnail() {
        document.getElementById('thumbnailDisplay').style.display = 'none';
    }

    // 关闭模态框
    document.querySelector('.close').onclick = function() {
        document.getElementById('dragonModal').style.display = 'none';
    }

    // 点击模态框外部关闭
    window.onclick = function(event) {
        const dragonModal = document.getElementById('dragonModal');
        const animalModal = document.getElementById('animalModal');
        const thumbnailDisplay = document.getElementById('thumbnailDisplay');
        const yuzhulongDisplay = document.getElementById('yuzhulongDisplay');
        
        if (event.target == dragonModal) {
            dragonModal.style.display = 'none';
        }
        
        if (event.target == animalModal) {
            closeAnimalModal();
        }
        
        if (event.target == thumbnailDisplay) {
            closeThumbnail();
        }
        
        if (event.target == yuzhulongDisplay) {
            closeYuzhulongImage();
        }
    }

    // 解码馆图片数据
    const hallImages = [
        "images/3.Hall/龙.png"
    ];
    
    // 龙身体部位对应的动物数据
    const dragonParts = {
        "horn": {
            name: "角",
            animal: "鹿",
            image: "images/3.Hall/鹿.png",
            description: "龙的角来源于鹿的鹿角"
        },
        "forehead": {
            name: "前额",
            animal: "骆驼",
            image: "images/3.Hall/骆驼.png",
            description: "龙的前额来源于骆驼的额头"
        },
        "eye": {
            name: "眼",
            animal: "老虎",
            image: "images/3.Hall/老虎.png",
            description: "龙的眼睛来源于老虎的眼睛"
        },
        "tail": {
            name: "尾",
            animal: "泥鳅",
            image: "images/3.Hall/泥鳅.png",
            description: "龙的尾巴来源于泥鳅的尾巴"
        },
        "claw": {
            name: "爪",
            animal: "鹰",
            image: "images/3.Hall/鹰.png",
            description: "龙的爪子来源于鹰的爪子"
        },
        "scale": {
            name: "鳞",
            animal: "金鱼",
            image: "images/3.Hall/金鱼.png",
            description: "龙的鳞片来源于金鱼的鳞片"
        },
        "body": {
            name: "身",
            animal: "蛇",
            image: "images/3.Hall/蛇.png",
            description: "龙的身体来源于蛇的身体"
        }
    };
    
    // 记录已查看的部位
    let viewedParts = new Set();
    
    let currentHallImageIndex = 0;
    
    // 初始化 Pannellum Viewer
    const viewer = pannellum.viewer('panorama', {
        "default": {
            "firstScene": "entrance", // 初始场景
            "author": "实验小学 黄金艳",
            "sceneFadeDuration": 1000
        },
        "scenes": scenes
    });
    
    // 监听热点双击事件
    viewer.on('hotspotclick', function(hotSpot) {
        // 检查是否有双击处理函数
        if (hotSpot.dblClickHandlerFunc) {
            // 使用定时器检测双击
            if (!hotSpot.lastClickTime) {
                hotSpot.lastClickTime = Date.now();
            } else {
                const timeDiff = Date.now() - hotSpot.lastClickTime;
                if (timeDiff < 300) { // 300ms内的两次点击认为是双击
                    hotSpot.dblClickHandlerFunc();
                    hotSpot.lastClickTime = 0; // 重置
                } else {
                    hotSpot.lastClickTime = Date.now();
                }
            }
        }
    });
    
        // 监听场景切换事件，为博物馆场景添加进入动画
    viewer.on('scenechange', function(sceneId) {
        if (sceneId === 'museum') {
            // 显示嵌入的玉猪龙图片
            const museumYuzhulong = document.getElementById('museumYuzhulong');
            museumYuzhulong.style.display = 'block';
            
            // 延迟执行进入动画，确保场景加载完成
            setTimeout(function() {
                // 从远到近的进入效果：设置较远的起始视角
                viewer.setPitch(-25);
                viewer.setYaw(0);
                viewer.setHfov(140);
                
                // 第一阶段：缓慢推进
                setTimeout(function() {
                    viewer.animate({
                        pitch: -20,
                        yaw: 0,
                        hfov: 120,
                        speed: '0.3rpm'
                    });
                }, 800);
                
                // 第二阶段：继续推进
                setTimeout(function() {
                    viewer.animate({
                        pitch: -15,
                        yaw: 0,
                        hfov: 100,
                        speed: '0.4rpm'
                    });
                }, 3000);
                
                // 第三阶段：最终到达目标位置
                setTimeout(function() {
                    viewer.animate({
                        pitch: -5,
                        yaw: 0,
                        hfov: 90,
                        speed: '0.2rpm'
                    });
                }, 6000);
            }, 500);
        } else if (sceneId === 'hall') {
            // 进入解码馆时自动显示图片1
            setTimeout(function() {
                showHallImage(0);
            }, 1000);
        } else {
            // 其他场景时隐藏玉猪龙图片
            const museumYuzhulong = document.getElementById('museumYuzhulong');
            museumYuzhulong.style.display = 'none';
        }
    });
    
    // 显示解码馆图片
    function showHallImage(index) {
        if (index >= 0 && index < hallImages.length) {
            currentHallImageIndex = index;
            const imageDisplay = document.getElementById('hallImageDisplay');
            const currentImage = document.getElementById('hallCurrentImage');
            
            // 确保图片展示在body的最顶层
            if (imageDisplay.parentNode !== document.body) {
                document.body.appendChild(imageDisplay);
            }
            
            currentImage.src = hallImages[index];
            imageDisplay.style.display = 'block';
            imageDisplay.style.zIndex = '2147483647';
            
            // 检查是否在全屏模式
            const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
            if (isFullscreen) {
                imageDisplay.style.zIndex = '2147483647';
            }
            
            // 强制刷新显示
            setTimeout(() => {
                imageDisplay.style.display = 'none';
                imageDisplay.offsetHeight; // 触发重排
                imageDisplay.style.display = 'block';
                imageDisplay.style.zIndex = '2147483647';
                console.log('解码馆图片显示，z-index:', imageDisplay.style.zIndex, '全屏模式:', isFullscreen);
            }, 10);
            
            // 绑定龙身体部位热点事件
            bindDragonHotspots();
        }
    }
    
    // 绑定龙身体部位热点事件
    function bindDragonHotspots() {
        const hotspots = document.querySelectorAll('.dragon-hotspot');
        hotspots.forEach(hotspot => {
            // 重置热点为初始状态（隐藏状态）
            const partKey = hotspot.getAttribute('data-part');
            const part = dragonParts[partKey];
            if (part) {
                hotspot.innerHTML = '';
                hotspot.style.background = 'transparent';
                hotspot.style.border = 'none';
                hotspot.style.display = 'flex';
                hotspot.style.alignItems = 'center';
                hotspot.style.justifyContent = 'center';
                hotspot.style.width = '100px';
                hotspot.style.height = '100px';
            }
            
            hotspot.onclick = function() {
                const part = this.getAttribute('data-part');
                showAnimalInfo(part);
            };
        });
    }
    
    // 显示动物信息
    function showAnimalInfo(partKey) {
        const part = dragonParts[partKey];
        if (!part) return;
        
        const modal = document.getElementById('animalModal');
        const title = document.getElementById('animalTitle');
        const description = document.getElementById('animalDescription');
        const animalImg = document.getElementById('animalImg');
        
        title.textContent = `${part.name} (${part.animal})`;
        description.textContent = part.description;
        animalImg.src = part.image;
        animalImg.alt = part.animal;
        
        // 存储当前显示的部位信息
        modal.dataset.currentPart = partKey;
        
        // 确保模态框在body的最顶层
        if (modal.parentNode !== document.body) {
            document.body.appendChild(modal);
        }
        
        modal.style.display = 'block';
        modal.style.zIndex = '2147483647';
        
        // 检查是否在全屏模式
        const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
        if (isFullscreen) {
            modal.style.zIndex = '2147483647';
        }
        
        // 强制刷新显示
        setTimeout(() => {
            modal.style.display = 'none';
            modal.offsetHeight; // 触发重排
            modal.style.display = 'block';
            modal.style.zIndex = '2147483647';
            console.log('动物信息显示，z-index:', modal.style.zIndex, '全屏模式:', isFullscreen);
        }, 10);
    }
    
    // 检查是否所有部位都已查看
    function checkAllPartsViewed() {
        const allParts = Object.keys(dragonParts);
        const viewedCount = viewedParts.size;
        
        if (viewedCount === allParts.length) {
            // 所有部位查看完毕，添加点击图片中部触发集合的功能
            addCenterClickHandler();
        }
    }
    
    // 添加点击图片中部触发集合的功能
    function addCenterClickHandler() {
        const hallImage = document.getElementById('hallCurrentImage');
        if (hallImage) {
            // 移除之前的事件监听器（如果有的话）
            hallImage.removeEventListener('click', handleCenterClick);
            // 添加新的事件监听器
            hallImage.addEventListener('click', handleCenterClick);
        }
    }
    
    // 处理图片中部点击事件
    function handleCenterClick(event) {
        // 检查是否所有部位都已查看
        const allParts = Object.keys(dragonParts);
        const viewedCount = viewedParts.size;
        
        if (viewedCount === allParts.length) {
            // 计算点击位置是否在图片中部
            const rect = event.target.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            const clickX = event.clientX;
            const clickY = event.clientY;
            
            // 定义中部区域（图片中心30%的区域）
            const centerArea = Math.min(rect.width, rect.height) * 0.3;
            const distanceFromCenter = Math.sqrt(
                Math.pow(clickX - centerX, 2) + Math.pow(clickY - centerY, 2)
            );
            
            if (distanceFromCenter <= centerArea) {
                // 点击在图片中部，触发集合动画
                animateCollectionToCenter();
                
                // 移除点击事件，避免重复触发
                event.target.removeEventListener('click', handleCenterClick);
            }
        }
    }
    
    // 动画集合到中部
    function animateCollectionToCenter() {
        const hotspots = document.querySelectorAll('.dragon-hotspot');
        
        // 创建集合容器
        const collectionContainer = document.createElement('div');
        collectionContainer.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
        `;
        document.getElementById('hallImageDisplay').appendChild(collectionContainer);
        
        // 为每个热点添加动画类
        hotspots.forEach((hotspot, index) => {
            const smallImg = hotspot.querySelector('img');
            if (smallImg) {
                // 创建新的图片元素用于动画
                const animatedImg = document.createElement('div');
                animatedImg.style.cssText = `
                    position: absolute;
                    width: 100px;
                    height: 100px;
                    border-radius: 50%;
                    overflow: hidden;
                    border: 3px solid #8B4513;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    transition: all 2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    z-index: ${1001 + index};
                `;
                
                const imgClone = smallImg.cloneNode(true);
                imgClone.style.cssText = `
                    width: 100%;
                    height: 100%;
                    object-fit: cover;
                `;
                animatedImg.appendChild(imgClone);
                
                // 设置初始位置（分散在周围）
                const angle = (index / hotspots.length) * 2 * Math.PI;
                const radius = 150;
                const startX = Math.cos(angle) * radius;
                const startY = Math.sin(angle) * radius;
                
                animatedImg.style.transform = `translate(${startX}px, ${startY}px) scale(0.8)`;
                collectionContainer.appendChild(animatedImg);
                
                // 延迟动画，让每个图片依次移动
                setTimeout(() => {
                    // 计算最终位置（围绕中心排列）
                    const finalAngle = (index / hotspots.length) * 2 * Math.PI;
                    const finalRadius = 60;
                    const finalX = Math.cos(finalAngle) * finalRadius;
                    const finalY = Math.sin(finalAngle) * finalRadius;
                    
                    animatedImg.style.transform = `translate(${finalX}px, ${finalY}px) scale(0.6) rotate(360deg)`;
                    animatedImg.style.border = '2px solid #8B4513';
                    
                }, index * 400); // 每个图片间隔400ms移动
            }
        });
        
        // 所有图片移动完成后显示文案
        setTimeout(() => {
            showCollectionText();
        }, hotspots.length * 400 + 2500);
    }
    
    // 显示集合文案
    function showCollectionText() {
        const centerCollection = document.getElementById('centerCollection');
        
        // 创建文案容器
        const textContainer = document.createElement('div');
        textContainer.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 248, 220, 0.95));
            border: 3px solid #8B4513;
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            z-index: 1002;
            max-width: 650px;
            animation: fadeInScale 1.5s ease-out;
            backdrop-filter: blur(10px);
        `;
        
        // 添加装饰性边框
        const borderDecoration = document.createElement('div');
        borderDecoration.style.cssText = `
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #8B4513, #D2691E, #8B4513);
            border-radius: 20px;
            z-index: -1;
            animation: borderGlow 2s ease-in-out infinite alternate;
        `;
        textContainer.appendChild(borderDecoration);
        
        // 添加标题
        const title = document.createElement('div');
        title.textContent = '龙，乃万兽之首';
        title.style.cssText = `
            font-size: 32px;
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: titleGlow 2s ease-in-out infinite alternate;
            position: relative;
        `;
        
        // 添加描述
        const description = document.createElement('div');
        description.textContent = '人们为龙选用的不同动物的部位，是摄取了最精华、最完美的部位，集如此多优势于一身的造型自然是万物之灵，同时也寄托了人们美好的愿望。';
        description.style.cssText = `
            font-size: 18px;
            line-height: 1.8;
            color: #333;
            text-align: justify;
            margin-bottom: 30px;
            animation: textFadeIn 1s ease-out 0.5s both;
        `;
        
        // 添加点击查看详情按钮
        const detailBtn = document.createElement('button');
        detailBtn.textContent = '点击查看详情';
        detailBtn.style.cssText = `
            background: linear-gradient(135deg, #8B4513, #A0522D);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
            animation: buttonPulse 2s ease-in-out infinite;
        `;
        
        detailBtn.onmouseover = function() {
            this.style.background = 'linear-gradient(135deg, #A0522D, #CD853F)';
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 6px 20px rgba(139, 69, 19, 0.4)';
        };
        
        detailBtn.onmouseout = function() {
            this.style.background = 'linear-gradient(135deg, #8B4513, #A0522D)';
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 4px 15px rgba(139, 69, 19, 0.3)';
        };
        
        detailBtn.onclick = function() {
            showCollectionModal();
            // 移除文案容器
            textContainer.remove();
        };
        
        // 组装文案容器
        textContainer.appendChild(title);
        textContainer.appendChild(description);
        textContainer.appendChild(detailBtn);
        
        // 添加到页面
        document.getElementById('hallImageDisplay').appendChild(textContainer);
        
        // 添加动画样式
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInScale {
                from {
                    opacity: 0;
                    transform: translate(-50%, -50%) scale(0.5) rotate(-5deg);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%) scale(1) rotate(0deg);
                }
            }
            
            @keyframes borderGlow {
                from {
                    opacity: 0.7;
                }
                to {
                    opacity: 1;
                }
            }
            
            @keyframes titleGlow {
                from {
                    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
                }
                to {
                    text-shadow: 2px 2px 8px rgba(139, 69, 19, 0.3);
                }
            }
            
            @keyframes textFadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            @keyframes buttonPulse {
                0%, 100% {
                    transform: scale(1);
                }
                50% {
                    transform: scale(1.05);
                }
            }
        `;
        document.head.appendChild(style);
    }
    
    // 显示集合模态框
    function showCollectionModal() {
        const modal = document.getElementById('collectionModal');
        const collectionImages = document.getElementById('collectionImages');
        
        // 清空并添加所有动物图片
        collectionImages.innerHTML = '';
        Object.values(dragonParts).forEach(part => {
            const imgContainer = document.createElement('div');
            imgContainer.style.textAlign = 'center';
            
            const img = document.createElement('img');
            img.src = part.image;
            img.alt = part.animal;
            img.style.width = '80px';
            img.style.height = '80px';
            img.style.objectFit = 'cover';
            img.style.borderRadius = '50%';
            img.style.border = '2px solid #8B4513';
            img.style.marginBottom = '5px';
            
            const label = document.createElement('div');
            label.textContent = part.animal;
            label.style.fontSize = '12px';
            label.style.color = '#8B4513';
            label.style.fontWeight = 'bold';
            
            imgContainer.appendChild(img);
            imgContainer.appendChild(label);
            collectionImages.appendChild(imgContainer);
        });
        
        // 确保模态框在body的最顶层
        if (modal.parentNode !== document.body) {
            document.body.appendChild(modal);
        }
        
        modal.style.display = 'block';
        modal.style.zIndex = '2147483647';
        
        // 检查是否在全屏模式
        const isFullscreen = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement;
        if (isFullscreen) {
            modal.style.zIndex = '2147483647';
        }
        
        // 强制刷新显示
        setTimeout(() => {
            modal.style.display = 'none';
            modal.offsetHeight; // 触发重排
            modal.style.display = 'block';
            modal.style.zIndex = '2147483647';
            console.log('集合模态框显示，z-index:', modal.style.zIndex, '全屏模式:', isFullscreen);
        }, 10);
    }
    
    // 关闭集合模态框
    function closeCollectionModal() {
        document.getElementById('collectionModal').style.display = 'none';
    }
    
    // 关闭动物信息模态框并显示小图片
    function closeAnimalModal() {
        const modal = document.getElementById('animalModal');
        const partKey = modal.dataset.currentPart;
        const part = dragonParts[partKey];
        
        if (part) {
            // 记录已查看的部位
            viewedParts.add(partKey);
            
            // 找到对应的热点元素
            const hotspot = document.querySelector(`[data-part="${partKey}"]`);
            if (hotspot) {
                // 清空热点内容并添加小图片
                hotspot.innerHTML = '';
                hotspot.style.background = 'rgba(255, 255, 255, 0.9)';
                hotspot.style.border = '2px solid #8B4513';
                hotspot.style.borderRadius = '50%';
                hotspot.style.display = 'flex';
                hotspot.style.alignItems = 'center';
                hotspot.style.justifyContent = 'center';
                hotspot.style.overflow = 'hidden';
                hotspot.style.width = '100px';
                hotspot.style.height = '100px';
                
                // 创建小图片
                const smallImg = document.createElement('img');
                smallImg.src = part.image;
                smallImg.alt = part.animal;
                smallImg.style.width = '100px';
                smallImg.style.height = '100px';
                smallImg.style.objectFit = 'cover';
                smallImg.style.borderRadius = '50%';
                
                hotspot.appendChild(smallImg);
                
                // 更新点击事件，点击小图片可以重新打开模态框
                hotspot.onclick = function() {
                    showAnimalInfo(partKey);
                };
            }
            
            // 检查是否所有部位都已查看
            checkAllPartsViewed();
        }
        
        modal.style.display = 'none';
    }
    
    // 关闭解码馆图片显示
    function closeHallImage() {
        document.getElementById('hallImageDisplay').style.display = 'none';
    }
    
    // 绑定按钮事件
    document.getElementById('closeHallBtn').onclick = closeHallImage;
    document.getElementById('resetBtn').onclick = resetHallExperience;
    document.getElementById('closeThumbnailBtn').onclick = closeThumbnail;
    document.getElementById('closeYuzhulongBtn').onclick = closeYuzhulongImage;
    
    // 重置解码馆体验
    function resetHallExperience() {
        // 清空已查看的部位记录
        viewedParts.clear();
        
        // 移除所有动画元素
        const animatedElements = document.querySelectorAll('[style*="z-index: 1001"], [style*="z-index: 1002"]');
        animatedElements.forEach(element => element.remove());
        
        // 重置热点状态
        const hotspots = document.querySelectorAll('.dragon-hotspot');
        hotspots.forEach(hotspot => {
            hotspot.innerHTML = '';
            hotspot.style.background = 'transparent';
            hotspot.style.border = 'none';
            hotspot.style.display = 'flex';
            hotspot.style.alignItems = 'center';
            hotspot.style.justifyContent = 'center';
            hotspot.style.width = '100px';
            hotspot.style.height = '100px';
            hotspot.style.position = 'absolute';
            hotspot.style.zIndex = 'auto';
            hotspot.style.transition = 'none';
            hotspot.style.transform = 'none';
            
            // 重新绑定点击事件
            const partKey = hotspot.getAttribute('data-part');
            hotspot.onclick = function() {
                showAnimalInfo(partKey);
            };
        });
        
        // 移除图片中部的点击事件
        const hallImage = document.getElementById('hallCurrentImage');
        if (hallImage) {
            hallImage.removeEventListener('click', handleCenterClick);
        }
        

        
        // 显示重置成功提示
        const resetMessage = document.createElement('div');
        resetMessage.textContent = '已重置，请重新点击各个部位';
        resetMessage.style.cssText = `
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(139, 69, 19, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 10000;
            font-size: 14px;
        `;
        document.body.appendChild(resetMessage);
        
        // 3秒后移除提示
        setTimeout(() => {
            resetMessage.remove();
        }, 3000);
    }
</script>
</body>
</html>
